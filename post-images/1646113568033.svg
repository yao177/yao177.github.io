<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="538px" preserveAspectRatio="none" style="width:473px;height:538px;background:#FFFFFF;" version="1.1" viewBox="0 0 473 538" width="473px" zoomAndPan="magnify"><defs><filter height="300%" id="f1iwwssln8w7sc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="233.5" cy="20" fill="#000000" filter="url(#f1iwwssln8w7sc)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1iwwssln8w7sc)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="56" x="205.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="36" x="215.5" y="71.6016">主线程</text><rect fill="#FFFFFF" filter="url(#f1iwwssln8w7sc)" height="305.0195" style="stroke:#000000;stroke-width:2.0;" width="445" x="11" y="120.1191"/><path d="M215,120.1191 L215,129.6074 L205,139.6074 L11,139.6074 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194" x="14" y="134.6543">synchronized(singleObjects)</text><rect fill="#FEFECE" filter="url(#f1iwwssln8w7sc)" height="34.1328" style="stroke:#A80036;stroke-width:1.5;" width="121" x="173" y="156.6074"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="183" y="178.209">异步初始化 beanA</text><rect fill="#000000" filter="url(#f1iwwssln8w7sc)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="425" x="21" y="210.7402"/><rect fill="#FEFECE" filter="url(#f1iwwssln8w7sc)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="156" x="33" y="290.873"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109" x="43" y="312.4746">等待所有 bean 异步</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="43" y="326.6074">初始化完成 futureA.get()</text><rect fill="#FEFECE" filter="url(#f1iwwssln8w7sc)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="143" x="254" y="236.7402"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="123" x="264" y="258.3418">BeanFactory#getBean</text><rect fill="#FEFECE" filter="url(#f1iwwssln8w7sc)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="217" x="217" y="305.0059"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="197" x="227" y="326.6074">synchronized(singleObjects)被阻塞</text><ellipse cx="325.5" cy="369.1387" fill="#FFFFFF" filter="url(#f1iwwssln8w7sc)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.5;" x1="319.3128" x2="331.6872" y1="362.9515" y2="375.3259"/><line style="stroke:#000000;stroke-width:2.5;" x1="331.6872" x2="319.3128" y1="362.9515" y2="375.3259"/><polygon fill="#FEFECE" filter="url(#f1iwwssln8w7sc)" points="233.5,389.1387,245.5,401.1387,233.5,413.1387,221.5,401.1387,233.5,389.1387" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1iwwssln8w7sc)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="68" x="199.5" y="445.1387"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="209.5" y="466.7402">加载完成</text><ellipse cx="233.5" cy="510.2715" fill="#FFFFFF" filter="url(#f1iwwssln8w7sc)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="233.5" cy="510.2715" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="233.5" x2="233.5" y1="30" y2="50"/><polygon fill="#A80036" points="229.5,40,233.5,50,237.5,40,233.5,44" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="325.5" x2="325.5" y1="270.873" y2="305.0059"/><polygon fill="#A80036" points="321.5,295.0059,325.5,305.0059,329.5,295.0059,325.5,299.0059" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="325.5" x2="325.5" y1="339.1387" y2="359.1387"/><polygon fill="#A80036" points="321.5,349.1387,325.5,359.1387,329.5,349.1387,325.5,353.1387" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="111" x2="111" y1="216.7402" y2="290.873"/><polygon fill="#A80036" points="107,280.873,111,290.873,115,280.873,111,284.873" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="325.5" x2="325.5" y1="216.7402" y2="236.7402"/><polygon fill="#A80036" points="321.5,226.7402,325.5,236.7402,329.5,226.7402,325.5,230.7402" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="51" x="329.5" y="230.8975">创建线程2</text><line style="stroke:#A80036;stroke-width:1.5;" x1="111" x2="111" y1="339.1387" y2="401.1387"/><line style="stroke:#A80036;stroke-width:1.5;" x1="111" x2="221.5" y1="401.1387" y2="401.1387"/><polygon fill="#A80036" points="211.5,397.1387,221.5,401.1387,211.5,405.1387,215.5,401.1387" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="233.5" x2="233.5" y1="190.7402" y2="210.7402"/><polygon fill="#A80036" points="229.5,200.7402,233.5,210.7402,237.5,200.7402,233.5,204.7402" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="233.5" x2="233.5" y1="84.1328" y2="156.6074"/><polygon fill="#A80036" points="229.5,146.6074,233.5,156.6074,237.5,146.6074,233.5,150.6074" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="237.5" y="105.5879">Spring 开始</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="59" x="237.5" y="118.543">加载 beanA</text><line style="stroke:#A80036;stroke-width:1.5;" x1="233.5" x2="233.5" y1="413.1387" y2="445.1387"/><polygon fill="#A80036" points="229.5,435.1387,233.5,445.1387,237.5,435.1387,233.5,439.1387" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="233.5" x2="233.5" y1="479.2715" y2="499.2715"/><polygon fill="#A80036" points="229.5,489.2715,233.5,499.2715,237.5,489.2715,233.5,493.2715" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[856a62e519fff85d743dd521e3d4de34]
@startuml 对象锁过程
start
:主线程;
-> Spring 开始
加载 beanA;
partition synchronized(singleObjects) {
    :异步初始化 beanA]
    fork
    :等待所有 bean 异步
    初始化完成 futureA.get();
    fork again
    -> 创建线程2;
    :BeanFactory#getBean;
    :synchronized(singleObjects)被阻塞;
    end
    end merge
}
:加载完成;
stop
@enduml

PlantUML version 1.2022.0(Wed Jan 12 00:16:42 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>