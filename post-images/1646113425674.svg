<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="508px" preserveAspectRatio="none" style="width:453px;height:508px;background:#FFFFFF;" version="1.1" viewBox="0 0 453 508" width="453px" zoomAndPan="magnify"><defs><filter height="300%" id="f12q7jencr7xl3" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="223.5" cy="20" fill="#000000" filter="url(#f12q7jencr7xl3)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f12q7jencr7xl3)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="56" x="195.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="36" x="205.5" y="71.6016">主线程</text><rect fill="#FEFECE" filter="url(#f12q7jencr7xl3)" height="34.1328" style="stroke:#A80036;stroke-width:1.5;" width="121" x="163" y="138.3633"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="173" y="159.9648">异步初始化 beanA</text><rect fill="#000000" filter="url(#f12q7jencr7xl3)" height="6" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1.0;" width="425" x="11" y="192.4961"/><rect fill="#FEFECE" filter="url(#f12q7jencr7xl3)" height="48.2656" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="156" x="23" y="272.6289"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="109" x="33" y="294.2305">等待所有 bean 异步</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="33" y="308.3633">初始化完成 futureA.get()</text><rect fill="#FEFECE" filter="url(#f12q7jencr7xl3)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="143" x="244" y="218.4961"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="123" x="254" y="240.0977">BeanFactory#getBean</text><rect fill="#FEFECE" filter="url(#f12q7jencr7xl3)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="217" x="207" y="286.7617"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="197" x="217" y="308.3633">synchronized(singleObjects)被阻塞</text><ellipse cx="315.5" cy="350.8945" fill="#FFFFFF" filter="url(#f12q7jencr7xl3)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:2.5;" x1="309.3128" x2="321.6872" y1="344.7073" y2="357.0817"/><line style="stroke:#000000;stroke-width:2.5;" x1="321.6872" x2="309.3128" y1="344.7073" y2="357.0817"/><polygon fill="#FEFECE" filter="url(#f12q7jencr7xl3)" points="223.5,370.8945,235.5,382.8945,223.5,394.8945,211.5,382.8945,223.5,370.8945" style="stroke:#A80036;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f12q7jencr7xl3)" height="34.1328" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="68" x="189.5" y="414.8945"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="199.5" y="436.4961">加载完成</text><ellipse cx="223.5" cy="480.0273" fill="#FFFFFF" filter="url(#f12q7jencr7xl3)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="223.5" cy="480.0273" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="223.5" x2="223.5" y1="30" y2="50"/><polygon fill="#A80036" points="219.5,40,223.5,50,227.5,40,223.5,44" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="223.5" x2="223.5" y1="84.1328" y2="138.3633"/><polygon fill="#A80036" points="219.5,128.3633,223.5,138.3633,227.5,128.3633,223.5,132.3633" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="60" x="227.5" y="105.5879">Spring 开始</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="59" x="227.5" y="118.543">加载 beanA</text><line style="stroke:#A80036;stroke-width:1.5;" x1="315.5" x2="315.5" y1="252.6289" y2="286.7617"/><polygon fill="#A80036" points="311.5,276.7617,315.5,286.7617,319.5,276.7617,315.5,280.7617" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="315.5" x2="315.5" y1="320.8945" y2="340.8945"/><polygon fill="#A80036" points="311.5,330.8945,315.5,340.8945,319.5,330.8945,315.5,334.8945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="101" x2="101" y1="198.4961" y2="272.6289"/><polygon fill="#A80036" points="97,262.6289,101,272.6289,105,262.6289,101,266.6289" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="315.5" x2="315.5" y1="198.4961" y2="218.4961"/><polygon fill="#A80036" points="311.5,208.4961,315.5,218.4961,319.5,208.4961,315.5,212.4961" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="51" x="319.5" y="212.6533">创建线程2</text><line style="stroke:#A80036;stroke-width:1.5;" x1="101" x2="101" y1="320.8945" y2="382.8945"/><line style="stroke:#A80036;stroke-width:1.5;" x1="101" x2="211.5" y1="382.8945" y2="382.8945"/><polygon fill="#A80036" points="201.5,378.8945,211.5,382.8945,201.5,386.8945,205.5,382.8945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="223.5" x2="223.5" y1="172.4961" y2="192.4961"/><polygon fill="#A80036" points="219.5,182.4961,223.5,192.4961,227.5,182.4961,223.5,186.4961" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="223.5" x2="223.5" y1="394.8945" y2="414.8945"/><polygon fill="#A80036" points="219.5,404.8945,223.5,414.8945,227.5,404.8945,223.5,408.8945" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="223.5" x2="223.5" y1="449.0273" y2="469.0273"/><polygon fill="#A80036" points="219.5,459.0273,223.5,469.0273,227.5,459.0273,223.5,463.0273" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[08f405f4aeea6e45d34fda93ac43caee]
@startuml 对象锁
start
:主线程;
-> Spring 开始
加载 beanA;
:异步初始化 beanA]
fork
:等待所有 bean 异步
初始化完成 futureA.get();
fork again
-> 创建线程2;
:BeanFactory#getBean;
:synchronized(singleObjects)被阻塞;
end
end merge
:加载完成;
stop
@enduml

PlantUML version 1.2022.0(Wed Jan 12 00:16:42 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>